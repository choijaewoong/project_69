<div class="write_container" style="display:none">
    <!--게시글 작성 폼-->
    <center>   
        <!--<p><%#= @board.description %></p>-->
        <div class="button_section">            
            <a href="#" id="log_in" class="login_button">글 쓰기</a>
        </div>
        <div class="form_section" style="display:none">
            <div class="write_form">            
                <input type="hidden" id="write_board" value="<%= @board.id %>">
                <div class="context_wrapper">
                    <div class="left"></div>
                    <div class="right"></div>
                    <div id="write_context" class="text_area" contenteditable="true" wrap="hard"></div>
                </div>
                <br>
                <!--<textarea id="write_context" required></textarea>                            -->
                <!--<p id="text_count">300</p>-->
            </div><br>
            
            <!--색상 선택-->
            <select id="colorpicker" name="colorpicker">
                <% $COLOR_ARRAY.each do |color| %>
                    <option value="<%= color %>"><%= color %> </option>
                <% end %>
            </select><br>
            
            <!--전송 버튼(체크 모양)-->
            <a href="#" id="write_button" style="margin-top:30px">
                <span class="glyphicon glyphicon-ok btn-lg" aria-hidden="true"></span>
            </a>
        </div>
    </center>
</div>

<!--모든 게시물-->
<div class="post_container" style="display:none">
    
    <div class="masonry">        
        
        <!--첫번째 게시물 옆 빈 공간-->
        <div class="empty_form stamp-item">            
        </div>   
       
        
        <!--첫번째 게시물-->
        <!--% if @post_all.count != 0 %>-->
        <!--    %= render :partial => '/board/post_form', -->
        <!--               :locals => {:post => @post_first } %>        -->
        <!--% end %>       -->
        
        <!--나머지 게시물-->
        <!--<#% if @post_all.count != 0 %>-->
        
        <% @post_part.each do |post| %>
           <%= render :partial => '/board/post_form', 
                      :locals => {:post => post } %>               
        <% end %>
        <!--<#% end %>-->
    </div>
    
    <div class="more_button_space">
        <button id="more_button">더보기</button>
    </div>
</div>
    
<script>
    var resolution = window.screen.width;
    var size = resolution*0.23;
    var empty_left = resolution*0.24;
    var post_margin_bottom = resolution*0.025;
    var bottom_link = resolution*0.01;
    var top_link = resolution*0.015;
    var link_width = resolution * 0.005;
    
    $(function(){
        // console.log(resolution);
        $('.empty_form').css({'width':size +'px'});
        $('.empty_form').css({'left':empty_left +'px'});
        $('.post_form').css({'width':size +'px'});
        $('.post_form').css({'height':size +'px'});
        $('.write_form').css({'width':size +'px'});
        $('.write_form').css({'height':size +'px'});           
        
        $('.post_form').css({'margin-bottom':post_margin_bottom +'px'});
        $('.link').css({'height': link_width + 'px'});
        $('.bottom').css({'bottom':bottom_link +'px'});
        $('.top').css({'bottom':top_link +'px'});
        $('.write_container').show();
        $('.post_container').show();
    });

    $(function(){
        // $(#hide_section).hide();
        $("#log_in").click(function(){
           $(".form_section").show(); 
           $(".hide_section").hide();
        });
    });  

    $(function(){
        if( <%= @post_all.count %> <= <%= $board_show_count %>){
            $(".more_button_space").hide();                            
        }
    });

    // 글자 수 카운트 하는 부분 
    // $(function(){
    //     $('#write_context').keyup(function(){            
    //         var inputLength = $(this).html().length;
    //         var remain = 300 - inputLength;
    //         $("#text_count").html(remain);
    //     });
    // });

    
    // 색상 선택 부분 
    $(function(){        
        $('select[name="colorpicker"]').simplecolorpicker(
            {theme: 'regularfont'}
            ).on('change', function() {
                
                $('.write_form').css("border-color", $("#colorpicker").val());                
        });        
    });

    
    // 게시글 item 생성 함수
    function create_item(post, color, reply_count){
        var time = new Date(post.created_at);
        var item = $(
            "<div class='masonry-item'><center>"
                + "<div class='link top' style='height:" + link_width + "px; bottom:" + top_link + "px; "
                    + "background:-webkit-linear-gradient(left, " + color + " 30%, rgba(0, 0, 0, 0) 70%);"
                    + "background:-ms-linear-gradient(left, " + color + " 30%, rgba(0, 0, 0, 0) 70%);"
                    + "background:-moz-linear-gradient(left, " + color + " 30%, rgba(0, 0, 0, 0) 70%);"
                    + "background:linear-gradient(left, " + color + " 30%, rgba(0, 0, 0, 0) 70%)'>"
                + "</div>"
                + "<div class='post_form' style='border-color:" + color
                    + "; width:" + size + "px; height:" + size + "px; margin-bottom:" + post_margin_bottom + "px'>"
                    + "<div class='context_wrapper'>"
                        + "<div class='left'></div>"
                        + "<div class='right'></div>"
                        + "<a href='/board/detail/" + post.id + "' data-transition='fade'>"
                            + "<div class='context'>" + post.context + "</div>"
                        + "</a>"
                    + "</div>"
                    + "<div class='time_section'>"
                        + "<span class='glyphicon glyphicon-time' aria-hidden='true'></span> " + moment(time).fromNow()
                    + "</div>"
                    // + "<span class='glyphicon glyphicon-heart' aria-hidden='true'></span> " + data.post.like_count
                    + "<img src='/assets/1_unlike.png' width=17 height=16>   " + post.like_count
                    + "&nbsp;&nbsp;&nbsp;&nbsp;"
                    + "<img src='/assets/2_not-reply.png' width=15 height=17>  " + reply_count
                + "</div>"
                + "<div class='link bottom' style='height:" + link_width + "px; bottom:" + bottom_link + "px; "
                    + "background:-webkit-linear-gradient(left,  rgba(0, 0, 0, 0) 30%, " + color + " 60%);"
                    + "background:-ms-linear-gradient(left,  rgba(0, 0, 0, 0) 30%, " + color + " 60%);"
                    + "background:-moz-linear-gradient(left,  rgba(0, 0, 0, 0) 30%, " + color + " 60%);"
                    + "background:linear-gradient(left,  rgba(0, 0, 0, 0) 30%, " + color + " 60%)'>"
                + "</div>"
            + "</center></div>"
            ); 
        return item;
    }

    // 게시물 작성
    $(function(){     
        //masonry 추가
        var $grid = $('.masonry').masonry({
            itemSelector: '.masonry-item',
            stamp: '.stamp-item'
        });   
            
        //작성 버튼 눌렀을 때 게시글 추가하는 기능 부분
        $("#write_button").click(
            function(){       
                $.ajax({
                    data: { context: $("#write_context").html(),
                            board: $("#write_board").val(),
                            color: $("#colorpicker").val()},
                    url: "/board/write",
                    success: function(data){    
                        
                        var item = create_item(data.post, $("#colorpicker").val(), data.reply_count);
                          
                        $grid.prepend(item)
                             .masonry('prepended', item);
                        
                        $("#text_count").html(300);     
                        $("#write_context").html('');                              
                    }
                });
        });
        
        // 게시글 더보기 구현 부분 
        var $last_id = <%= @last_post_id %>;
        $("#more_button").click(
            function(){
                console.log( $last_id );
                
                // var item_array = [];
                var $count = <%= $board_show_count %>;  // 추가 할 게시글 개수 
                
                $.ajax({
                    data: { board_id : <%= @board.id %>,
                            last_id: $last_id,
                            count: $count},
                    url: "/board/more_post",
                    success: function(data){
                        
                        // console.log(data.next_check);
                        if(!data.next_check){
                            $(".more_button_space").hide();                            
                        }
                        // if(data.post_array.length > 0)
                        for(i = 0; i < data.post_array.length; i++){

                            var item = create_item(data.post_array[i], data.color_array[i], data.reply_count_array[i]);
                            
                            // item_array.push(item);
                            $grid.append(item)
                             .masonry('appended', item);
                        }

                        // var $item_array = $(item_array);
                        $last_id -= data.post_array.length;
                    }
                });
        });
    });   
    
    // 게시판 체크
    $(function(){ 
        
        
        $('a.board_name').each(function(i, category){            
            if($(this).html() == "<%=@board.description %>"){
                $(this).css("color", "#EE3C39");
                return false;
            }            
        });
        $('a.board_name').on('click', function(){
            $('a.board_name').css("color", "#ffffff");
            $(this).css("color", "#EE3C39");
        });
    });
    
    // $(window).on('hashchange', function() {
    //     console.log("hhel");  
    // });
    
    // $( window ).on("unload", function() {
        
    //   window.location.reload(true);
    // });
    
        
    // $(function(){
    //     $(window).on("navigate", function(event, data) {
            
    //         console.log("hello");
            
    //         var direction = data.state.direction;
    //         // if (direction == 'back') {
    //         console.log("hello");
    //             // window.location.reload(true);
    //             // do something
            
    //         // if (direction == 'forward') {
    //         //     // window.location.reload(true);
    //         //     // do something else
    //         // }
    //     });
    // });
    
    // $(function(){
        
    //      var $grid = $('.masonry').isotope({
    //         itemSelector: '.masonry-item',
    //         getSortData: {
    //             // context: '.context'              
    //             category : '[data-like]'
              
    //         }
    //       });
        
    //       // bind sort button click
    //       $('.right_nav').on( 'click', 'a', function() {
    //         // var sortValue = $(this).attr('data-sort-value');
    //         console.log("clicked");
    //         $grid.isotope({ sortBy: "category" });
    //       });       
    // });
</script>




